<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Summarized Articles</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body
  data-initial-offset="{{ items|length if items is defined else 0 }}"
  data-page-size="5"
>
  <form class="search" method="get" action="/">
    <input
        type="text"
        name="q"
        value="{{ q if q is defined else '' }}"
        placeholder="Search keyword..."
        style="width:55%;padding:0.4rem;border-radius:6px;border:1px solid #ccc;"
    />
    <select id="sourceFilter" style="padding:0.4rem;border-radius:6px;border:1px solid #ccc;">
        <option value="">All sources</option>
    </select>
    <button type="submit" style="padding:0.4rem 0.8rem;">Search</button>
    </form>

  <form id="refreshForm" onsubmit="return false;" style="margin-bottom:1rem;">
    <button id="refreshBtn" type="button">Refresh now</button>
    <span id="status" style="margin-left:0.5rem;color:#555;"></span>
  </form>

  <div id="list">
  {% if not items or items|length == 0 %}
    <div class="card">
      <p>No summaries yet.</p>
      <p>Click <strong>Refresh now</strong> to fetch and summarize the latest articles.</p>
    </div>
  {% else %}
    {% for item in items %}
      <div class="card">
        {% if item.image_url %}
          <div>
            <img src="{{ item.image_url }}" alt="" style="max-width:100%;border-radius:8px;margin-bottom:0.5rem;">
          </div>
        {% endif %}
        <div class="title"><a href="{{ item.url }}" target="_blank">{{ item.title }}</a></div>
        {% if item.published_date %}
        <div style="font-size:0.9rem;color:#666;margin-bottom:0.4rem;">
            {{ item.published_date }}
        </div>
        {% elif item.published_at %}
        <div style="font-size:0.9rem;color:#666;margin-bottom:0.4rem;">
            {{ item.published_at }}
        </div>
        {% endif %}
        <p>{{ item.summary }}</p>
        {% if item.takeaways %}
          <ul class="takeaways">
            {% for t in item.takeaways %}<li>{{ t }}</li>{% endfor %}
          </ul>
        {% endif %}
      </div>
    {% endfor %}
  {% endif %}
  </div>

  <div style="text-align:center;margin:1rem 0;">
    <button id="loadMoreBtn" type="button">Load more</button>
  </div>

  <script src="/static/script.js"></script>
</body>
</html>
